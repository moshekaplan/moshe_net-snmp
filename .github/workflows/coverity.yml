# GitHub actions workflow.
# https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions

# https://scan.coverity.com/projects/google-breakpad
name: Coverity Scan

on:
  schedule:
    - cron: '0 0 * * SUN'
  workflow_dispatch:
jobs:
  coverity:
    runs-on: ubuntu-latest
    env:
      CC: clang
      CXX: clang++
    steps:
    - uses: actions/checkout@main
    - run: find . -type f -iname "*" -exec chmod +x {} \;
    - name: install required packages
      run: sudo bash -c "MODE=regular ci/install.sh"
    - name: build
      run: ci/build.sh
    - uses: vapier/coverity-scan-action@v1
      with:
        command: make -C src -O -j$(getconf _NPROCESSORS_CONF)
        email: ${{ secrets.COVERITY_SCAN_EMAIL }}
        token: ${{ secrets.COVERITY_SCAN_TOKEN }}
